{% extends "base.html" %}
{% block content %}
<div class="stats-card">
  <strong>Total Students:</strong> {{ students|length }}
</div>
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h6 class="mb-2">Branch-wise Student Count</h6>
    {% for branch, count in branch_counts.items() %}
      <span class="badge bg-primary me-2 mb-2">
        {{ branch }} : {{ count }}
      </span>
    {% endfor %}
  </div>



<h3 class="section-title">
  <i class="bi bi-person-plus-fill"></i> Student Registration
</h3>


<div class="card shadow-sm mb-4">
  <div class="card-body">


<form method="POST" class="mb-4">

  <div class="mb-3">
   <input class="form-control" name="name" placeholder="Name" required autofocus>
 
  </div>
  <div class="mb-3">
    <input class="form-control" name="roll" placeholder="Roll No" required>
  </div>
  <div class="mb-3">
    <select class="form-control" name="branch" required>
    <option value="">-- Select Branch --</option>
    <option value="CSE">CSE</option>
    <option value="CSE-AI">CSE-AI</option>
    <option value="CSE-AIML">CSE-AIML</option>
    <option value="CSE-DS">CSE-DS</option>
    <option value="CSE-ML">CSE-ML</option>
    <option value="CSE-CyberSecurity">CSE-CyberSecurity</option>
    <option value="ECE">ECE</option>
    <option value="EEE">EEE</option>
    <option value="Mechanical Engineering">Mechanical Engineering</option>
    <option value="Civil Engineering">Civil Engineering</option>
</select>

  </div>
  <div class="mb-3">
    <input class="form-control" name="email" type="email" placeholder="Email" required>
  </div>
  
    <div class="d-grid gap-2 d-md-block">
  <button
  id="registerBtn"
  class="btn btn-success"
  onclick="showLoading(this)">
  Register
</button>


  <a href="/download" class="btn btn-primary ms-md-2">
    Download Excel
  </a>
</div>

</form>
  </div>
</div>


<hr>

<form method="GET">
  <input class="form-control" name="search" placeholder="Search by name">
</form>
<div class="card shadow-sm">
  <div class="card-body">

<div class="table-responsive">
  <table class="table table-bordered mt-3">

<tr>
<th>Name</th><th>Roll</th><th>Branch</th><th>Email</th><th>Date</th><th>Action</th>
</tr>

{% if students|length == 0 %}
<tr>
  <td colspan="6" class="text-center text-muted">
    No students registered yet
  </td>
</tr>
{% else %}
  {% for s in students %}
  <tr>
    <td>{{ s.name }}</td>
    <td>{{ s.roll }}</td>
    <td>{{ s.branch }}</td>
    <td>{{ s.email }}</td>
    <td>{{ s.created_at.strftime("%d %b %Y, %I:%M %p") }}</td>
    <td>
      <a href="/edit/{{ s.id }}" class="btn btn-warning btn-sm">
        <i class="bi bi-pencil-square"></i> Edit
      </a>
      <a href="/delete/{{ s.id }}"
   onclick="return confirm('Are you sure you want to delete this student?')"
   class="btn btn-danger btn-sm">

        <i class="bi bi-trash-fill"></i> Delete
      </a>
    </td>
  </tr>
  {% endfor %}
{% endif %}

</table>
  </div>
</div>
</div>
</div>

<script>
  function showLoading(btn) {
    // 1. Disable the button
    btn.disabled = true;

    // 2. Change button text + show spinner
    btn.innerHTML = `
      <span class="spinner-border spinner-border-sm"></span>
      Registering...
    `;

    // 3. Submit the form
    btn.form.submit();
  }
</script>

{% endblock %}
